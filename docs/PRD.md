# SajuToday - 사주팔자/운세 앱 PRD (Product Requirements Document)

## 1. 프로젝트 개요

### 1.1 기본 정보
| 항목 | 내용 |
|------|------|
| **프로젝트명** | SajuToday (사주투데이) |
| **플랫폼** | Android (Expo/React Native) |
| **타깃 사용자** | 한국 사용자 (20-50대, 운세/사주에 관심 있는 일반인) |
| **핵심 가치** | 정확한 사주 계산 + 재미있고 유익한 일일 운세 |

### 1.2 핵심 원칙
1. **정확성**: 사주/역법 계산은 규칙 기반으로 정확하게 (KASI API + 만세력)
2. **창작성**: 운세 문구는 Claude가 생성 (외부 크롤링 금지)
3. **안전성**: 과한 단정, 의료/투자 조언 금지 (면책 포함)
4. **프라이버시**: 생년월일 등 민감 정보는 로컬 저장 우선

---

## 2. 기능 명세 (MVP)

### 2.1 사용자 입력 (온보딩)

| 필드 | 타입 | 필수 | 설명 |
|------|------|------|------|
| 생년월일 | Date | O | YYYY-MM-DD |
| 출생 시간 | Time/Enum | X | HH:mm 또는 "모름" |
| 달력 유형 | Enum | O | 양력(solar) / 음력(lunar) |
| 윤달 여부 | Boolean | △ | 음력 선택 시에만 |
| 성별 | Enum | X | 남/여/미선택 (문구 스타일용) |
| 타임존 | String | O | 기본값: Asia/Seoul |

### 2.2 사주 프로필 산출

#### 출력 항목
- **4주 (年月日時)**: 각 주의 천간/지지
- **오행 분포**: 목(木), 화(火), 토(土), 금(金), 수(水) 개수
- **음양 비율**: 음(陰) / 양(陽) 비율
- **일간 (Day Master)**: 일주의 천간 (성격/운명의 핵심)
- **십신 관계**: 년주/월주/시주의 십신 (MVP: 기본만)
- **합/충 관계**: 지지 간 충(沖)/합(合) (MVP: 기본만)

#### 해석 카드 (짧은 버전)
1. **성향 요약**: 1-2문장
2. **강점**: 2-3개 키워드
3. **주의점**: 1-2개 키워드

### 2.3 오늘의 운세

#### 입력 조건
- 오늘 날짜의 간지 (일진)
- 오늘의 절기/특일 (KASI API)
- 사용자 사주 프로필

#### 출력 카드
| 항목 | 내용 |
|------|------|
| **총운** | 한 줄 요약 (15-30자) |
| **점수** | 전체/재물/일·학업/연애·대인/건강 (0-100) |
| **재물운** | 2-3문장 |
| **일·학업운** | 2-3문장 |
| **연애·대인운** | 2-3문장 |
| **건강운** | 2-3문장 |
| **키워드** | 3개 |
| **추천 행동** | 1개 |
| **피해야 할 것** | 1개 |
| **면책 문구** | 고정 문구 |

### 2.4 히스토리
- 날짜별 운세 저장 (최근 30일)
- 날짜 선택하여 과거 운세 조회
- 오프라인에서도 저장된 운세 확인

### 2.5 설정
- 톤 설정: 친근함 / 차분함 / 유머러스 / 진지함
- 길이 설정: 짧게 / 보통 / 자세히
- 알림 설정: 매일 운세 알림 시간
- 프로필 수정: 생년월일/시간 재입력

---

## 3. 기술 아키텍처

### 3.1 전체 구조
```
┌─────────────────────────────────────────────────────────┐
│                    SajuToday App                        │
│                  (Expo/React Native)                    │
├─────────────────────────────────────────────────────────┤
│  UI Layer                                               │
│  ├─ OnboardingScreen (입력)                             │
│  ├─ HomeScreen (오늘 운세)                              │
│  ├─ ProfileScreen (내 사주)                             │
│  ├─ HistoryScreen (히스토리)                            │
│  └─ SettingsScreen (설정)                               │
├─────────────────────────────────────────────────────────┤
│  Business Logic Layer                                   │
│  ├─ SajuCalculator (사주 계산 - 로컬)                   │
│  ├─ FortuneGenerator (운세 생성 - Claude API)          │
│  └─ KasiService (음양력/특일 - KASI API)               │
├─────────────────────────────────────────────────────────┤
│  Data Layer                                             │
│  ├─ AsyncStorage (프로필/설정)                          │
│  ├─ SQLite (운세 히스토리)                              │
│  └─ API Cache (KASI 응답 캐시)                          │
└─────────────────────────────────────────────────────────┘
         │                    │
         ▼                    ▼
┌─────────────────┐  ┌─────────────────┐
│   KASI API      │  │   Claude API    │
│ (음양력/특일)   │  │  (운세 생성)    │
└─────────────────┘  └─────────────────┘
```

### 3.2 MVP에서의 단순화
- **백엔드 서버 없음**: 모든 계산/저장은 앱 내부
- **API 키 관리**: 환경 변수로 관리 (빌드 시 포함)
- **KASI API**: 앱에서 직접 호출 (CORS 우회 필요 시 프록시)

### 3.3 향후 확장 (Post-MVP)
- 백엔드 서버 추가 (API 키 보안)
- 사용자 계정/로그인
- 클라우드 동기화
- 프리미엄 기능 (상세 해석, 궁합 등)

---

## 4. 화면 설계 (IA)

### 4.1 화면 흐름
```
앱 시작
    │
    ├─ [최초 실행] ──▶ 온보딩 (입력)
    │                      │
    │                      ▼
    │                 사주 계산
    │                      │
    └─ [재실행] ───────────┴──▶ 홈 (오늘 운세)
                                    │
                    ┌───────────────┼───────────────┐
                    ▼               ▼               ▼
              내 사주          히스토리          설정
              (프로필)        (과거 운세)       (환경설정)
```

### 4.2 화면별 상세

#### 4.2.1 온보딩 (Onboarding)
- Step 1: 생년월일 입력 (DatePicker)
- Step 2: 양력/음력 선택 + 윤달 체크
- Step 3: 출생 시간 입력 (TimePicker / "모름" 버튼)
- Step 4: 성별 선택 (선택사항)
- Step 5: 사주 계산 결과 미리보기 → 저장

#### 4.2.2 홈 (Home)
- 상단: 오늘 날짜 + 간지 + 절기
- 메인 카드: 총운 + 점수
- 카테고리 카드: 재물/일/연애/건강 (탭 또는 스와이프)
- 하단: 키워드 3개 + 추천/피해야 할 것

#### 4.2.3 내 사주 (Profile)
- 4주 시각화 (년/월/일/시)
- 오행 분포 차트 (막대 또는 원형)
- 음양 비율
- 성향/강점/주의점 카드

#### 4.2.4 히스토리 (History)
- 캘린더 뷰 (운세 있는 날 표시)
- 날짜 선택 → 해당 날짜 운세 카드
- 최근 30일만 저장

#### 4.2.5 설정 (Settings)
- 톤 설정 (4가지 중 선택)
- 길이 설정 (3가지 중 선택)
- 알림 설정 (시간 선택)
- 프로필 수정
- 앱 정보 / 면책 조항

---

## 5. 디자인 가이드

### 5.1 컬러 팔레트
| 용도 | 색상 | Hex |
|------|------|-----|
| Primary | 자주색 (전통) | #8B4B8B |
| Secondary | 금색 (고급) | #D4AF37 |
| Background | 아이보리 | #FFFEF5 |
| Text Primary | 진한 갈색 | #3D3D3D |
| Text Secondary | 회색 | #7D7D7D |
| 목(木) | 초록 | #4CAF50 |
| 화(火) | 빨강 | #F44336 |
| 토(土) | 노랑 | #FFC107 |
| 금(金) | 흰색/은색 | #E0E0E0 |
| 수(水) | 파랑 | #2196F3 |

### 5.2 타이포그래피
- 제목: 나눔명조 또는 시스템 기본
- 본문: 프리텐다드 또는 시스템 기본
- 한자 표기: 한자 병기 시 작은 크기로

### 5.3 UI 스타일
- 카드 기반 레이아웃
- 부드러운 그림자
- 둥근 모서리 (borderRadius: 12-16)
- 전통 문양 포인트 (절제된 사용)

---

## 6. 안전/면책 정책

### 6.1 금지 표현
- "100%", "반드시", "무조건", "확실히"
- 구체적 질병명/치료법
- 구체적 투자 종목/매매 시점
- 특정 인물/단체 비방

### 6.2 면책 문구 (앱 내 표시)
```
본 서비스는 재미와 참고를 위한 것으로,
실제 의사결정의 근거로 삼지 마세요.
건강/재정 문제는 전문가와 상담하세요.
```

### 6.3 건강/재정 조언 가이드라인
- 건강: "충분한 수면", "스트레칭", "물 많이 마시기" 수준
- 재정: "충동구매 주의", "저축 습관", "지출 점검" 수준

---

## 7. 마일스톤

| 단계 | 내용 | 예상 |
|------|------|------|
| M1 | 프로젝트 설정 + 온보딩 UI | 1일 |
| M2 | 사주 계산 로직 구현 | 1일 |
| M3 | KASI API 연동 (음양력/특일) | 0.5일 |
| M4 | 홈 화면 + 운세 생성 (Claude) | 1일 |
| M5 | 프로필/히스토리/설정 화면 | 1일 |
| M6 | 테스트 + 버그 수정 | 0.5일 |
| **총계** | MVP 완성 | **5일** |

---

## 8. 테스트 케이스 (20개)

### 8.1 입력 검증
1. 양력 일반 날짜 입력 (1990-05-15)
2. 음력 일반 날짜 입력 (1990-04-21, 음력)
3. 음력 윤달 입력 (2020-04-15, 음력, 윤달)
4. 출생 시간 "모름" 선택 시 시주 제외 확인
5. 출생 시간 자시(23:30) 경계 처리
6. 미래 날짜 입력 시 에러 처리

### 8.2 사주 계산
7. 년주 계산 정확성 (입춘 기준 연도 변경)
8. 월주 계산 정확성 (절기 기준 월 변경)
9. 일주 계산 정확성 (60갑자 순환)
10. 시주 계산 정확성 (2시간 단위)
11. 오행 분포 계산 정확성
12. 음양 비율 계산 정확성

### 8.3 KASI API
13. 양력→음력 변환 정확성
14. 음력→양력 변환 정확성
15. 오늘 절기 정보 조회
16. 오늘 특일(공휴일) 정보 조회
17. API 에러 시 폴백 처리

### 8.4 운세 생성
18. Claude API 정상 응답 파싱
19. Claude API 에러 시 기본 운세 표시
20. 톤/길이 설정 반영 확인

### 8.5 저장/조회
21. 프로필 저장 후 재시작 시 유지
22. 운세 히스토리 저장/조회
23. 30일 초과 히스토리 자동 삭제

---

## 부록: 용어 정리

| 용어 | 설명 |
|------|------|
| 사주 (四柱) | 년주/월주/일주/시주, 4개의 기둥 |
| 팔자 (八字) | 4주 × 2(천간+지지) = 8글자 |
| 천간 (天干) | 갑을병정무기경신임계 (10개) |
| 지지 (地支) | 자축인묘진사오미신유술해 (12개) |
| 60갑자 | 천간×지지 조합 60개 (갑자~계해) |
| 오행 (五行) | 목화토금수 |
| 일간 (日干) | 일주의 천간, 본인을 상징 |
| 십신 (十神) | 일간 기준 다른 천간과의 관계 10가지 |
| 절기 (節氣) | 24절기, 월/년 변경 기준 |
